{% extends base %}

{% block preamble %}

    <!-- TODO: try to use only one static folder for common resources at least -->
    <!-- <link href="../../../electron-launcher/node_modules/bootstrap/dist/css/bootstrap.css" rel="stylesheet"> -->
    <link href="/ocean_data_qc/static/font-awesome-v5.3.1/css/all.min.css" rel="stylesheet" type="text/css" />
    <link href="/ocean_data_qc/static/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="/ocean_data_qc/static/css/custom.css" rel="stylesheet" type="text/css" />
    <link href="/ocean_data_qc/static/css/flags_control.css" rel="stylesheet" type="text/css" />

{% endblock %}

{% block inner_body %}
    {% block contents %}

    <div class="bokeh_page">
        <div>
            {{ embed(roots.bridge_row) }}
        </div>
        <div class="wrapper">
            <div class="content-wrapper">
                <div class="o_tabs">
                    {{ embed(roots.tabs_widget_col) }}
                </div>
            </div>
            <div class="o_sidebar">
                {{ embed(roots.sidebar_col) }}
            </div>
        </div>
    </div>


    {% endblock %}
    {{ plot_script | indent(8) }}

    <script>
        oldLog = console.log;
        console.log = function (message) {
            if(message.localeCompare('Bokeh items were rendered successfully') == 0){
                window.top.postMessage('bokeh-loaded', '*');
                console.log = oldLog;
            }
            oldLog.apply(console, arguments);
        };

        window.onmessage = function(e){
            if (typeof(e.data.signal) != "undefined") {
                if (e.data.signal == 'call-python-promise' || e.data.signal == 'update-bridge-text-value') {
                        // this updates dummy text field value and triggers the click event of the bridge_button

                        // NOTE: This cannot be replaced defining the onchange event of the dummy text, imagine that
                        //       you want to run the same action twice, there would'n be change on the value to trigger the python method

                        var models = window.Bokeh.index[Object.keys(window.Bokeh.index)[0]].model.document._all_models;
                        var input_bridge_text = models[e.data.message_data.bridge_text_id];
                        delete e.data.message_data['bridge_text_id'];
                        // console.log('>> New DUMMY TEXT value: ' + JSON.stringify(e.data.message_data));
                        input_bridge_text.value = JSON.stringify(e.data.message_data);
                        var button = document.getElementsByClassName('bridge_button')[0].firstChild;
                        button.click();
                }
            }

        };
    </script>

{% endblock %}
